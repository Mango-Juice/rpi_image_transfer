# E-paper GPIO ë“œë¼ì´ë²„ ê°€ì´ë“œ

GPIOë¥¼ í†µí•œ ì´ë¯¸ì§€ ì „ì†¡ì„ ìœ„í•œ ë¦¬ëˆ…ìŠ¤ ì»¤ë„ ë“œë¼ì´ë²„ì…ë‹ˆë‹¤.

## ğŸ”§ ë“œë¼ì´ë²„ êµ¬ì„±

- **tx_driver.c**: ì†¡ì‹  ë“œë¼ì´ë²„ (TX) - 5-pin ì‹œë¦¬ì–¼ í”„ë¡œí† ì½œ
- **rx_driver.c**: ìˆ˜ì‹  ë“œë¼ì´ë²„ (RX) - 5-pin ì‹œë¦¬ì–¼ í”„ë¡œí† ì½œ

## ğŸ“¡ í”„ë¡œí† ì½œ ì‚¬ì–‘ (5-pin ì‹œë¦¬ì–¼)

### GPIO í•€ êµ¬ì„±

| ì‹ í˜¸       | ì†¡ì‹ ì¸¡ | ìˆ˜ì‹ ì¸¡ | ì„¤ëª…                  |
| ---------- | ------ | ------ | --------------------- |
| CLOCK      | OUT    | IN     | ì‹œë¦¬ì–¼ í´ëŸ­ (ë™ê¸°í™”)  |
| DATA       | OUT    | IN     | ì‹œë¦¬ì–¼ ë°ì´í„° (1-bit) |
| START/STOP | OUT    | IN     | ì „ì†¡ ì‹œì‘/ì¢…ë£Œ ì‹ í˜¸   |
| ACK        | IN     | OUT    | ìˆ˜ì‹  í™•ì¸ ì‘ë‹µ        |
| NACK       | IN     | OUT    | ìˆ˜ì‹  ì˜¤ë¥˜ ì‘ë‹µ        |

### í†µì‹  í”„ë¡œí† ì½œ

1. **ì‹œë¦¬ì–¼ ì „ì†¡**: 1-bit ì§ë ¬ ë°ì´í„° ì „ì†¡
2. **ë¸”ë¡ ë‹¨ìœ„**: í—¤ë” + ë°ì´í„° + CRC32 ë¸”ë¡ ì „ì†¡
3. **ACK/NACK ì‘ë‹µ**: ë¸”ë¡ë³„ í™•ì¸
4. **ìë™ ì¬ì „ì†¡**: ì˜¤ë¥˜ ì‹œ ìµœëŒ€ 3íšŒ ì¬ì‹œë„

### ë°ì´í„° êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HEADER  â”‚   DATA    â”‚   CRC32     â”‚          â”‚
â”‚ (10bytes)â”‚ (variable)â”‚  (4bytes)   â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Header êµ¬ì¡°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WIDTH â”‚ HEIGHT â”‚ DATA_LENGTH â”‚ HEADER_CHECKSUM â”‚
â”‚(2byte)â”‚(2byte) â”‚  (4bytes)   â”‚    (2bytes)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ì„¤ì¹˜ ë° ì‚¬ìš©

### 1. ì»´íŒŒì¼

```bash
cd drivers
make
```

### 2. ëª¨ë“ˆ ë¡œë“œ

```bash
# TX ë“œë¼ì´ë²„ ë¡œë“œ
sudo insmod tx_driver.ko

# RX ë“œë¼ì´ë²„ ë¡œë“œ
sudo insmod rx_driver.ko
```

### 3. ë””ë°”ì´ìŠ¤ ë…¸ë“œ í™•ì¸

```bash
ls -l /dev/epaper_*
# /dev/epaper_tx - ì†¡ì‹  ë””ë°”ì´ìŠ¤
# /dev/epaper_rx - ìˆ˜ì‹  ë””ë°”ì´ìŠ¤
```

### 4. ê¶Œí•œ ì„¤ì • (í•„ìš”ì‹œ)

```bash
sudo chmod 666 /dev/epaper_tx
sudo chmod 666 /dev/epaper_rx
```

## ğŸ”— ë””ë°”ì´ìŠ¤ íŠ¸ë¦¬ ì„¤ì •

### TX ì¸¡ (ì†¡ì‹ ) ì„¤ì •

```dts
&gpio {
    epaper_tx: epaper_tx_device {
        compatible = "epaper,gpio-tx";
        clock-gpios = <&gpio 13 0>;        // Clock output
        data-gpios = <&gpio 5 0>;          // Data output
        start-stop-gpios = <&gpio 6 0>;    // Start/Stop output
        ack-gpios = <&gpio 16 0>;          // ACK input
        nack-gpios = <&gpio 12 0>;         // NACK input
        status = "okay";
    };
};
```

### RX ì¸¡ (ìˆ˜ì‹ ) ì„¤ì •

```dts
&gpio {
    epaper_rx: epaper_rx_device {
        compatible = "epaper,gpio-rx";
        clock-gpios = <&gpio 21 0>;        // Clock input
        data-gpios = <&gpio 19 0>;         // Data input
        start-stop-gpios = <&gpio 26 0>;   // Start/Stop input
        ack-gpios = <&gpio 25 0>;          // ACK output
        nack-gpios = <&gpio 20 0>;         // NACK output
        status = "okay";
    };
};
```

## ğŸ“ íŒŒì¼ ì¸í„°í˜ì´ìŠ¤

### TX ë“œë¼ì´ë²„ (/dev/epaper_tx)

- **ì—´ê¸°**: `open("/dev/epaper_tx", O_WRONLY)`
- **ì“°ê¸°**: `write(fd, data, size)` - ìë™ íŒ¨í‚·í™” ë° ì „ì†¡
- **ë‹«ê¸°**: `close(fd)`

### RX ë“œë¼ì´ë²„ (/dev/epaper_rx)

- **ì—´ê¸°**: `open("/dev/epaper_rx", O_RDONLY)`
- **ì½ê¸°**: `read(fd, buffer, size)` - ìˆ˜ì‹ ëœ ë°ì´í„° ì½ê¸°
- **ë‹«ê¸°**: `close(fd)`
- **poll**: ë°ì´í„° ëŒ€ê¸° ì§€ì›

## ğŸ” ìƒíƒœ ëª¨ë‹ˆí„°ë§

### ì»¤ë„ ë¡œê·¸ í™•ì¸

```bash
# ì‹¤ì‹œê°„ ë¡œê·¸ ë³´ê¸°
sudo dmesg -w | grep epaper

# ìµœê·¼ ë¡œê·¸ë§Œ ë³´ê¸°
dmesg | grep epaper | tail -20
```

### ë¡œê·¸ ë©”ì‹œì§€ ì˜ˆì‹œ

```
[epaper_tx] Driver loaded successfully
[epaper_tx] Image sent successfully
[epaper_tx] NACK received, retrying
[epaper_rx] Driver loaded successfully
[epaper_rx] Image received successfully (1920x1080, 2073600 bytes)
[epaper_rx] CRC32 validation passed
```

## âš¡ ì„±ëŠ¥ íŠ¹ì„±

### ì „ì†¡ ì†ë„

- **ì‹œë¦¬ì–¼ í´ëŸ­**: ì•½ 100kHz (udelay íƒ€ì´ë°)
- **ì´ë¯¸ì§€ í¬ê¸°**: ìµœëŒ€ 1920x1080 í”½ì…€
- **ì˜¤ë²„í—¤ë“œ**: í—¤ë”(10) + CRC32(4) = 14ë°”ì´íŠ¸

### ì‹ ë¢°ì„±

- **CRC32 ê²€ì¦**: 100% ë°ì´í„° ë¬´ê²°ì„±
- **ì¬ì „ì†¡ ë©”ì»¤ë‹ˆì¦˜**: ì˜¤ë¥˜ ì‹œ ìë™ ë³µêµ¬ (ìµœëŒ€ 3íšŒ)
- **íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬**: 2ì´ˆ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ë°ë“œë½ ë°©ì§€

## ğŸ› ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

#### 1. ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨

```bash
# ë¬¸ì œ: insmod ì‹¤íŒ¨
# í•´ê²°: ì»¤ë„ í—¤ë” ì„¤ì¹˜ í™•ì¸
sudo apt-get install linux-headers-$(uname -r)
```

#### 2. ë””ë°”ì´ìŠ¤ ë…¸ë“œê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ

```bash
# ë¬¸ì œ: /dev/epaper_* ì—†ìŒ
# í•´ê²°: ë””ë°”ì´ìŠ¤ íŠ¸ë¦¬ ì„¤ì • í™•ì¸ ë° ì¬ë¶€íŒ…
sudo reboot
```

#### 3. GPIO ê¶Œí•œ ì˜¤ë¥˜

```bash
# ë¬¸ì œ: GPIO ì ‘ê·¼ ì‹¤íŒ¨
# í•´ê²°: ì‚¬ìš©ìë¥¼ gpio ê·¸ë£¹ì— ì¶”ê°€
sudo usermod -a -G gpio $USER
```

#### 4. í•¸ë“œì…°ì´í¬ ì‹¤íŒ¨

```bash
# ì›ì¸: ì¼€ì´ë¸” ì—°ê²° ë¬¸ì œ ë˜ëŠ” GPIO í•€ ì¶©ëŒ
# í•´ê²°:
# 1. ì¼€ì´ë¸” ì—°ê²° í™•ì¸
# 2. GPIO í•€ ì‚¬ìš© í˜„í™© í™•ì¸
# 3. ë””ë°”ì´ìŠ¤ íŠ¸ë¦¬ GPIO ë²ˆí˜¸ í™•ì¸
```

### ë””ë²„ê¹… ëª…ë ¹ì–´

```bash
# ëª¨ë“ˆ ìƒíƒœ í™•ì¸
lsmod | grep epaper

# GPIO ì‚¬ìš© í˜„í™©
cat /sys/kernel/debug/gpio

# ë””ë°”ì´ìŠ¤ íŠ¸ë¦¬ í™•ì¸
cat /proc/device-tree/gpio/epaper-*/compatible

# IRQ ì‚¬ìš© í˜„í™©
cat /proc/interrupts | grep epaper
```

## ğŸ”§ ê³ ê¸‰ ì„¤ì •

### ì»¤ë„ ëª¨ë“ˆ ë§¤ê°œë³€ìˆ˜

í˜„ì¬ ë²„ì „ì€ ë§¤ê°œë³€ìˆ˜ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ëª¨ë“  ì„¤ì •ì€ ë””ë°”ì´ìŠ¤ íŠ¸ë¦¬ë¥¼ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

### ì„±ëŠ¥ íŠœë‹

1. **í´ëŸ­ ì†ë„ ì¡°ì •**: ë””ë°”ì´ìŠ¤ íŠ¸ë¦¬ì—ì„œ GPIO ë“œë¼ì´ë¸Œ ê°•ë„ ì„¤ì •
2. **IRQ ìš°ì„ ìˆœìœ„**: ì‹¤ì‹œê°„ ì»¤ë„ ì‚¬ìš© ì‹œ IRQ ìš°ì„ ìˆœìœ„ ì¡°ì •
3. **ë²„í¼ í¬ê¸°**: ì†ŒìŠ¤ ì½”ë“œì—ì„œ FIFO_SIZE ì¡°ì • í›„ ì¬ì»´íŒŒì¼

## ğŸ“Š ì œí•œì‚¬í•­

- **ìµœëŒ€ ì´ë¯¸ì§€ í¬ê¸°**: 1920x1080 í”½ì…€
- **GPIO í•€ ìˆ˜**: 5ê°œ (Clock + Data + Start/Stop + ACK + NACK)
- **ë™ì‹œ ì‚¬ìš©**: ê° ë””ë°”ì´ìŠ¤ë‹¹ í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ë§Œ
- **í”Œë«í¼**: ë¼ì¦ˆë² ë¦¬íŒŒì´ ë° í˜¸í™˜ SBC
- **ë°ì´í„° í˜•ì‹**: ë°”ì´ë„ˆë¦¬ ì´ë¯¸ì§€ ë°ì´í„° (width + height + data)

## ğŸ—‚ï¸ ëª¨ë“ˆ ì œê±°

```bash
# ë“œë¼ì´ë²„ ì–¸ë¡œë“œ
sudo rmmod tx_driver
sudo rmmod rx_driver

# ë””ë°”ì´ìŠ¤ ë…¸ë“œ ìë™ ì œê±°ë¨
```

## ğŸ“„ ë¼ì´ì„ ìŠ¤

GPL v2 ë¼ì´ì„ ìŠ¤ í•˜ì— ë°°í¬ë©ë‹ˆë‹¤.
